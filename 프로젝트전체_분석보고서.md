# 프로젝트 전체 분석 보고서
- 작성일 : 2026.01.01 (지속 업데이트 필요)

## 프로젝트 개요

**이름/목적:**
- **sammirack-estimator** - (주)삼미앵글 랙(선반) 견적 및 재고 관리 시스템
- 랙 제품(경량랙, 중량랙, 파렛트랙, 하이랙, 스텐랙 등)의 BOM 생성, 가격 계산, 견적서/청구서 작성, 재고 관리 기능 제공

**기술 스택:**
- **프론트엔드**: React 18.2.0, React Router DOM 6.23.1
- **빌드 도구**: Vite 5.2.0
- **스타일링**: Tailwind CSS 3.4.3
- **문서 생성**: jsPDF 2.5.1, html2canvas 1.4.1
- **엑셀 처리**: xlsx 0.18.5, exceljs 4.3.0
- **HTTP 클라이언트**: axios 1.6.8
- **배포**: GitHub Pages (base: '/sammirack-estimator/')

---

## 의존성 (중요도 순)

| 패키지 | 버전 | 역할 |
|--------|------|------|
| **react** | ^18.2.0 | UI 프레임워크 |
| **react-dom** | ^18.2.0 | React DOM 렌더링 |
| **react-router-dom** | ^6.23.1 | SPA 라우팅 |
| **vite** | ^5.2.0 | 빌드 도구 및 개발 서버 |
| **tailwindcss** | ^3.4.3 | 유틸리티 CSS 프레임워크 |
| **axios** | ^1.6.8 | HTTP 클라이언트 (Gist API 호출) |
| **xlsx** | ^0.18.5 | Excel 파일 읽기/쓰기 |
| **exceljs** | ^4.3.0 | Excel 파일 고급 처리 |
| **jspdf** | ^2.5.1 | PDF 생성 |
| **html2canvas** | ^1.4.1 | HTML → Canvas 변환 (PDF용) |
| **eslint** | ^8.57.0 | 코드 린팅 |

---

## 랙 종류별 상세 분석

### 1. **경량랙** (Light Rack)

**속성 선택 순서:**
```
size → height → level → formType
```

**특수 속성:**
- `height`: H750 선택 시 **H900 데이터를 사용** (특수 처리)
- `customMaterials`: **경량랙 전용** - 사용자 정의 자재 추가 가능

**BOM 구성:**
- 기둥: 독립형 4개, 연결형 2개
- 받침(상/하): 독립형 각 4개, 연결형 각 2개
- 연결대: level × 수량
- 선반: level × 수량
- 안전좌: level × 수량
- 안전핀: level × 수량

**Specification 생성 규칙:**
- 기둥: `${height}` (예: "H900")
- 선반: `W${w}xD${d}` (예: "W900xD300")
- 받침(상/하): `D${d}` (예: "D300")
- 연결대: `W${w}` (예: "W900")
- 안전좌/안전핀: 빈 문자열

**특수 케이스:**
- H750 선택 시 `makeLightRackH750BOM()` 함수로 별도 처리
- 사용자 정의 자재는 `customMaterials` 배열에서 추가

---

### 2. **중량랙** (Heavy Rack)

**속성 선택 순서:**
```
size → height → level → formType
```

**특수 속성:**
- 추가 옵션 사이즈 변환 규칙: `45x155` → `w1500xd450` (cm → mm 변환)

**BOM 구성:**
- 경량랙과 동일한 구조

**Specification 생성 규칙:**
- 경량랙과 동일

**추가 옵션 처리:**
- 중량랙 추가 옵션은 매핑 테이블(`EXTRA_TO_BASE_INVENTORY_MAPPING`)에서 specification 추출
- 예: `"중량랙-선반-w900xd450"` → specification: `"w900xd450"`

---

### 3. **파렛트랙** (Pallet Rack)

**속성 선택 순서:**
```
weight → size → height → level → formType
```
⚠️ **다른 랙과 다르게 weight가 첫 번째 속성**

**특수 속성:**
- `weight`: **필수 속성** (2t, 3t)
- `weight === "3t"`일 경우 specification에 `_3t` suffix 자동 추가
- 브레싱/브레싱볼트/브러싱고무는 weight 영향 없음

**BOM 구성:**
- 기둥: 독립형 4개, 연결형 2개
- 로드빔: 2 × level × 수량
- 타이빔: **특수 계산 규칙** (아래 참조)
- 안전핀: 2 × level × 2 × 수량
- 하드웨어: `appendCommonHardwareIfMissing()` 자동 추가

**타이빔 계산 규칙:**
```javascript
// 사이즈별 타이빔 개수/단
w === 1390 → 2개/단
w === 2590 || w === 2790 → 4개/단
기타 → 2개/단 (기본값)
```

**하드웨어 자동 계산:**
- 수평브레싱: 독립형 4개, 연결형 2개
- 경사브레싱: 높이에 따라 가변 (1500mm 기준, 500mm마다 증가)
- 브레싱볼트: 높이와 연결형 여부에 따라 계산
- 브러싱고무: 기둥 개수와 동일
- 앙카볼트: 독립형 4개, 연결형 2개

**Specification 생성 규칙:**
- 기둥: `${height}` (예: "H4500")
- 로드빔: `${w}` (예: "1390")
- 타이빔: `${d}` (예: "800")
- 안전핀: 빈 문자열
- 브레싱: `${d}` (깊이 값)
- **3t인 경우**: 모든 specification에 `_3t` suffix 추가 (하드웨어 제외)

**추가 옵션:**
- 높이: H4500, H5000, H5500, H6000

---

### 4. **파렛트랙 철판형** (Pallet Rack Iron Type)

**속성 선택 순서:**
```
size → height → level → formType
```

**특수 속성:**
- 타이빔 **제외** (파렛트랙과 차이점)
- 선반 **포함** (파렛트랙과 차이점)

**BOM 구성:**
- 파렛트랙과 동일하지만:
  - 타이빔 제외
  - 선반 추가 (아래 계산 규칙)

**선반 계산 규칙:**
```javascript
// 사이즈별 선반 개수/단
w === 1390 → 2개/단
w === 2090 → 3개/단
w === 2590 → 4개/단
기타 → 1개/단 (기본값)
```

**Specification 생성 규칙:**
- 선반: `사이즈 ${size}` (예: "사이즈 2090x800")
- 나머지는 파렛트랙과 동일

**추가 옵션:**
- 높이: 1500, 2000, 2500, 3000, 3500, 4000, H4500, H5000, H5500, H6000
- 사이즈: 2090x800, 2090x1000

---

### 5. **하이랙** (High Rack)

**속성 선택 순서:**
```
color → size → height → level → formType
```

**특수 속성:**
- `color`: **필수 속성** (색상별 무게 포함)
  - 예: "메트그레이(볼트식)270kg", "블루(기둥)+오렌지(가로대)(볼트식)450kg"
- `colorWeight`: 재고 관리용 색상 정보 저장
- **이중 ID 시스템**:
  - 단가 관리용: `generatePartId()` - 색상 제거
  - 재고 관리용: `generateInventoryPartId()` - 색상 포함

**고정 높이:**
- 150, 200, 250 (3가지만 가능)

**무게별 사이즈 제한:**
- 450kg/600kg/700kg: **45x150 사이즈 제외**
- 600kg/700kg: **80x200 사이즈 추가**

**BOM 구성:**
- 기둥: 독립형 4개, 연결형 2개
- 로드빔: 2 × level × 수량
- 선반: **특수 계산 규칙** (아래 참조)

**선반 계산 규칙:**
```javascript
// 깊이(d)별 선반 개수/단
d === 108 → 1개/단
d === 150 || d === 200 → 2개/단
기타 → 1개/단 (기본값)
```

**Specification 생성 규칙:**
- 기둥: `사이즈 ${size} 높이 ${height}${weight}` (예: "사이즈 45x150 높이 150 270kg")
- 로드빔: `${rodBeamNum}${weight}` (예: "108 270kg")
- 선반: `사이즈 ${size}${weight}` (예: "사이즈 45x108 270kg")

**색상 처리:**
- 단가 관리: 색상 정보 제거하여 통합 관리
- 재고 관리: 색상 정보 포함하여 정확한 재고 추적
- 예: "메트그레이(볼트식)270kg" vs "블루(기둥)+오렌지(가로대)(볼트식)270kg"

**추가 옵션:**
- 사이즈: 45x150
- 레벨: 5단, 6단
- 추가상품1~6: 색상별/무게별 선반/기둥 추가 옵션

---

### 6. **스텐랙** (Stainless Rack)

**속성 선택 순서:**
```
size → height → level → version
```

**특수 속성:**
- `version`: **V1만 존재** (고정값)

**BOM 구성:**
- 기둥: 4개
- 선반: level × 수량

**Specification 생성 규칙:**
- 기둥: `높이 ${height}` (예: "높이 210")
- 선반: `사이즈 ${size}` (예: "사이즈 50x75")

**추가 옵션:**
- 레벨: 5단, 6단
- 높이: 210

---

## 핵심 모듈 & 로직

### 1. **Context 계층** (`src/contexts/ProductContext.jsx`)
- 역할: 전역 상태 관리 (제품 옵션, 장바구니, BOM, 가격)
- 주요 기능:
  - 랙 타입별 옵션 관리 (size, height, level, formType, color, weight, version)
  - BOM 자동 계산 (부품 수량, 단가, 총액)
  - 장바구니 관리 (추가/삭제/수량 변경)
  - 관리자 단가 적용 및 가격 재계산
  - 추가 옵션 처리 (하이랙 색상별, 중량랙 사이즈별 등)
  - 서버 재고 데이터 연동
- **랙별 분기 처리:**
  - `formTypeRacks`: 경량랙, 중량랙, 파렛트랙 철판형
  - 파렛트랙: weight 우선 선택
  - 하이랙: color 우선 선택
  - 스텐랙: version 속성 포함

### 2. **서비스 계층** (`src/services/`)

**InventoryService.js**
- 역할: GitHub Gist 기반 재고 데이터 관리
- 기능:
  - `getInventory()`: Gist에서 재고 데이터 로드
  - `updateInventory(updates)`: 재고 수량 업데이트 (PATCH 요청)
- 외부 연동: GitHub Gist API (환경변수: `VITE_GITHUB_GIST_ID`, `VITE_GITHUB_TOKEN`)

**DocumentManager.js**
- 역할: 견적서/청구서 문서 CRUD
- 기능:
  - `createEstimate()`: 견적서 생성
  - `createPurchaseOrder()`: 청구서 생성
  - `convertEstimateToPurchaseOrder()`: 견적서 → 청구서 변환
  - `getDocumentHistory()`: 문서 목록 조회
  - `deleteDocument()`: 문서 삭제
- 저장소: localStorage (StorageService 사용)

**StorageService.js**
- 역할: localStorage 래퍼 (키 기반 데이터 저장/로드)

### 3. **유틸리티 계층** (`src/utils/`)

**unifiedPriceManager.js**
- 역할: 통합 단가 관리 시스템
- 핵심 기능:
  - `generatePartId()`: 단가 관리용 ID 생성 (색상 제거)
    - 하이랙: 메트그레이/매트그레이/오렌지/블루 제거
    - 형식: `랙타입-부품명-규격` (소문자, 공백/괄호 제거)
  - `generateInventoryPartId()`: 재고 관리용 ID 생성 (색상 포함)
    - 하이랙: colorWeight 정보 포함
    - 형식: `랙타입-부품명색상-규격`
  - `loadAdminPrices()`: 관리자 수정 단가 로드 (localStorage)
  - `getEffectivePrice()`: 효과적 단가 계산 (관리자 단가 우선)
  - `EXTRA_TO_BASE_INVENTORY_MAPPING`: 추가 옵션 → 기본 원자재 매핑 테이블
    - 스텐랙: 11개 매핑
    - 중량랙: 12개 매핑 (45x95 → w900xd450 형식)
    - 하이랙: 270kg/450kg/600kg별 매핑 (색상별 분리)
  - `EXTRA_TO_BASE_PARTID_MAPPING`: 단가 관리용 매핑 (색상 제거)
- 데이터 소스: `all_materials_list_v1.csv` (275개 부품)

**materialSort.js**
- 역할: BOM 정렬 규칙 (자재별 순서)

**bomRegeneration.js**
- 역할: 견적서 displayName에서 BOM 역추적 재생성

**excelExport.js**
- 역할: Excel 파일 내보내기

**printUtils.js**
- 역할: 인쇄/PDF 생성 유틸리티

### 4. **컴포넌트 계층** (`src/components/`)

**핵심 UI 컴포넌트:**
- `OptionSelector.jsx`: 랙 옵션 선택 UI
- `CartDisplay.jsx`: 장바구니 표시
- `BOMDisplay.jsx`: 부품 목록(BOM) 표시
- `MaterialPriceManager.jsx`: 자재 단가 관리 (관리자용)
- `InventoryManager.jsx`: 재고 관리 (관리자용)
- `ShortageInventoryManager.jsx`: 부족 재고 알림

**문서 생성 컴포넌트:**
- `EstimateForm.jsx`: 견적서 작성/편집
- `PurchaseOrderForm.jsx`: 청구서 작성/편집
- `DeliveryNoteForm.jsx`: 거래명세서 작성/편집
- `PrintPage.jsx`: 인쇄 페이지
- `HistoryPage.jsx`: 문서 이력 관리

**인증/설정:**
- `Login.jsx`: 로그인 (role: admin/user)
- `PasswordChange.jsx`: 비밀번호 변경
- `DocumentSettingsModal.jsx`: 문서 설정 모달

---

## 데이터/제어 흐름

```
[사용자 입력]
    ↓
[OptionSelector] → ProductContext.handleOptionChange()
    ↓
[ProductContext.calculateCurrentBOM()]
    ↓
[unifiedPriceManager.getEffectivePrice()] → 관리자 단가 우선 적용
    ↓
[ProductContext.calculatePrice()] → BOM 기반 가격 계산
    ↓
[CartDisplay] → 장바구니에 추가
    ↓
[EstimateForm/PurchaseOrderForm] → 문서 생성
    ↓
[DocumentManager.saveDocument()] → localStorage 저장
    ↓
[PrintPage] → PDF/Excel 내보내기
```

**재고 관리 흐름:**
```
[InventoryManager] → InventoryService.updateInventory()
    ↓
[GitHub Gist API PATCH] → inventory.json 업데이트
    ↓
[ProductContext.loadInventory()] → 재고 데이터 갱신
    ↓
[ShortageInventoryManager] → 부족 재고 알림
```

---

## 아키텍처 요약

**패턴**: 
- **Context API 기반 상태 관리** (단일 Context: ProductContext)
- **서비스 계층 분리** (InventoryService, DocumentManager, StorageService)
- **컴포넌트 기반 UI** (React 함수형 컴포넌트 + Hooks)

**데이터 저장소:**
- **클라이언트**: localStorage (문서, 설정, 관리자 단가)
- **서버**: GitHub Gist (재고 데이터: `inventory.json`)
- **정적 데이터**: public 폴더 (JSON: `data.json`, `bom_data_weight_added.json`, `extra_options.json`, CSV: `all_materials_list_v1.csv`)

**배포 환경:**
- **GitHub Pages** (정적 호스팅)
- **HashRouter** 사용 (SPA 라우팅)
- **환경변수**: Vite 환경변수 (`VITE_GITHUB_GIST_ID`, `VITE_GITHUB_TOKEN`)

**외부 연동:**
- **GitHub Gist API**: 재고 데이터 CRUD
- **로컬 파일 시스템**: CSV/JSON 데이터 로드

---

## Specification 생성 상세 규칙 (`ensureSpecification`)

### 공통 규칙
- 하드웨어 부품: specification 빈 문자열
  - 브러싱고무, 브레싱고무, 브레싱볼트, 앙카볼트, 안전핀, 안전좌

### 랙별 Specification 규칙

#### 경량랙/중량랙
- 기둥: `${height}` (예: "H900")
- 선반: `W${w}xD${d}` (예: "W900xD300")
- 받침(상/하): `D${d}` (예: "D300")
- 연결대: `W${w}` (예: "W900")

#### 파렛트랙/파렛트랙 철판형
- 기둥: `${height}` (예: "H4500")
- 로드빔: `${w}` (예: "1390")
- 타이빔: `${d}` (예: "800") - 파렛트랙만
- 선반: `사이즈 ${size}` (예: "사이즈 2090x800") - 파렛트랙 철판형만
- 브레싱: `${d}` (깊이 값)
- **3t 특수 처리**: 모든 specification에 `_3t` suffix (하드웨어 제외)

#### 하이랙
- 기둥: `사이즈 ${size} 높이 ${height}${weight}` (예: "사이즈 45x150 높이 150 270kg")
- 로드빔: `${rodBeamNum}${weight}` (예: "108 270kg")
- 선반: `사이즈 ${size}${weight}` (예: "사이즈 45x108 270kg")
- **색상 정보**: colorWeight 필드에 저장 (재고 관리용)

#### 스텐랙
- 기둥: `높이 ${height}` (예: "높이 210")
- 선반: `사이즈 ${size}` (예: "사이즈 50x75")

---

## 추가 옵션 처리 상세 로직 (`makeExtraOptionBOM`)

### 처리 흐름
1. 카테고리명에서 무게 정보 추출 (`extractWeightFromCategory`)
2. 매핑 테이블 확인 (`EXTRA_TO_BASE_INVENTORY_MAPPING`)
3. 매핑 성공 시 기본 원자재로 교체
4. 매핑 실패 시 별도 부품으로 처리

### 랙별 추가 옵션 특수 처리

#### 하이랙
- **색상 제거**: 단가 관리용 partId 생성 시 색상 정보 제거
- **색상 포함**: 재고 관리용 inventoryPartId 생성 시 색상 정보 포함
- **추가상품1~6**: 카테고리명 기반 색상/무게 추출
  - 추가상품1: 매트그레이 선반
  - 추가상품2: 오렌지 선반
  - 추가상품3: 메트그레이 기둥
  - 추가상품4: 메트그레이 450kg 기둥/선반
  - 추가상품5: 블루+오렌지 450kg 기둥/선반 (서버 ID 직접 생성)
  - 추가상품6: 블루+오렌지 600kg 선반+빔 (BOM 분리 처리)

#### 중량랙
- **사이즈 변환**: `45x155` → `w1500xd450` (cm → mm)
- 매핑 테이블에서 specification 추출

#### 스텐랙
- 매핑 테이블에서 specification 추출

---

## BOM 계산 특수 규칙

### 수량 계산 규칙

#### 기둥 수량
- 독립형: 4개 × 수량
- 연결형: 2개 × 수량
- 예외: 하이랙은 level이 아닌 formType 기준

#### 선반 수량
- 경량랙/중량랙: level × 수량
- 파렛트랙 철판형: `calcPalletIronShelfPerLevel(size) × level × 수량`
- 하이랙: `calcHighRackShelfPerLevel(size) × level × 수량`
- 스텐랙: level × 수량

#### 타이빔 수량 (파렛트랙만)
- 사이즈별 개수/단:
  - 1390: 2개/단
  - 2590/2790: 4개/단
  - 기타: 2개/단
- 계산: `타이빔개수/단 × level × 수량`

#### 로드빔 수량
- 파렛트랙/파렛트랙 철판형: 2 × level × 수량
- 하이랙: 2 × level × 수량

#### 안전핀 수량
- 파렛트랙/파렛트랙 철판형: 2 × level × 2 × 수량
- 경량랙/중량랙: level × 수량

#### 하드웨어 수량 (파렛트랙/파렛트랙 철판형)
- 수평브레싱: 독립형 4개, 연결형 2개
- 경사브레싱: 높이에 따라 가변
  ```javascript
  baseHeight = 1500mm
  heightStep = 500mm
  baseDiagonal = 독립형 4개, 연결형 2개
  additionalSteps = Math.floor((heightMm - baseHeight) / heightStep)
  additionalDiagonal = (독립형 2개, 연결형 1개) × additionalSteps
  최종 = (baseDiagonal + additionalDiagonal) × 수량
  ```
- 브레싱볼트:
  ```javascript
  baseHeight = 1500mm
  perUnit = 10 + Math.max(0, Math.floor((heightMm - baseHeight) / 500)) × 2
  연결형일 경우 perUnit = Math.floor(perUnit / 2)
  최종 = perUnit × 수량
  ```
- 브러싱고무: 기둥 개수와 동일
- 앙카볼트: 독립형 4개, 연결형 2개

---

## 가격 계산 특수 규칙

### 가격 계산 우선순위
1. `customPrice > 0`: 사용자 지정 가격 사용
2. BOM 기반 가격: 모든 부품 단가 합산
3. 기본가격: data.json의 기본가격 (백업용)

### 랙별 가격 계산 방식

#### 경량랙/중량랙/파렛트랙 철판형
- BOM 기반 가격 우선
- 기본가격 백업 경로:
  - 파렛트랙 철판형: `data[타입]["기본가격"][formType][size][height][level]`
  - 기타: `data[타입]["기본가격"][size][height][level][formType]`

#### 파렛트랙
- **BOM 합산 기준만 사용** (기본가격 백업 없음)

#### 하이랙
- BOM 기반 가격 우선
- 기본가격 백업: `data["하이랙"]["기본가격"][color][size][height][level]`
- **formType 필수**: formType 없으면 가격 0 반환

#### 스텐랙
- BOM 기반 가격 우선
- 기본가격 백업: `data["스텐랙"]["기본가격"][size][height][level]`

### 관리자 단가 적용
- `getEffectivePrice()`: 관리자 수정 단가 우선 적용
- 관리자 단가가 없으면 `item.unitPrice` 사용
- BOM 계산 시 각 부품별로 효과적 단가 적용

---

## 추천 개선점

1. **상태 관리 개선**
   - Context API 단일화 → Redux/Zustand 고려 (복잡도 증가 시)
   - `ProductContext.jsx` 파일 크기 축소 (2134줄 → 모듈 분리)

2. **에러 처리 강화**
   - Gist API 실패 시 폴백 로직 (로컬 캐시)
   - 네트워크 오류 사용자 알림

3. **성능 최적화**
   - BOM 계산 메모이제이션 강화
   - 대용량 CSV 로딩 최적화 (스트리밍/청크)

4. **타입 안정성**
   - TypeScript 마이그레이션 검토
   - PropTypes 또는 JSDoc 타입 정의

5. **테스트 코드**
   - 단위 테스트 (BOM 계산 로직)
   - 통합 테스트 (문서 생성 플로우)

6. **보안**
   - GitHub Token 환경변수 관리 강화
   - 로그인 인증 토큰 암호화

7. **문서화**
   - API 문서화 (JSDoc)
   - 사용자 매뉴얼

---

---

## 데이터 구조 상세

### 정적 데이터 파일

#### `data.json`
- 구조: `{ 랙타입: { 기본가격: { ... } } }`
- 하이랙: `{ 하이랙: { 기본가격: { 색상: { 사이즈: { 높이: { 레벨: 가격 } } } } } }`
- 스텐랙: `{ 스텐랙: { 기본가격: { 사이즈: { 높이: { 레벨: 가격 } } } } }`
- 경량랙/중량랙/파렛트랙 철판형: `{ 타입: { 기본가격: { 사이즈: { 높이: { 레벨: { formType: 가격 } } } } } }`

#### `bom_data_weight_added.json`
- 구조: `{ 랙타입: { 사이즈: { 높이: { 레벨: { formType: { components: [...] } } } } } }`
- 파렛트랙: `{ 파렛트랙: { weight: { 사이즈: { 높이: { 레벨: { formType: { components: [...] } } } } } } }`
- components 배열: `{ name, quantity, unit_price, total_price, specification, note }`

#### `extra_options.json`
- 구조: `{ 랙타입: { 카테고리명: [ { id, name, price, quantity, bom, specification, colorWeight } ] } }`
- 카테고리명 예: "추가상품1 (270kg 매트그레이 선반추가)", "추가상품4 (450kg 메트그레이 기둥 및 선반추가)"

#### `all_materials_list_v1.csv` / `all_materials_list_v2.csv`
- 275개 부품 데이터
- 컬럼: 부품ID, 랙타입, 부품명, 규격, 단가 등

---

## 특수 케이스 및 예외 처리

### 1. 경량랙 H750 특수 처리
- **문제**: H750 데이터가 bom_data에 없음
- **해결**: H900 데이터를 사용하도록 매핑
- **코드 위치**: `selectedType === "경량랙" && selectedOptions.height === "H750"` 분기

### 2. 파렛트랙 3t 무게급 처리
- **문제**: 3t인 경우 specification에 `_3t` suffix 필요
- **해결**: `ensureSpecification`에서 `isPalletRack3t` 플래그 확인
- **예외**: 브레싱/브레싱볼트/브러싱고무는 무게급 구분 없음

### 3. 하이랙 색상별 ID 분리
- **문제**: 단가 관리와 재고 관리를 분리해야 함
- **해결**: 
  - 단가 관리: `generatePartId()` - 색상 제거하여 통합 관리
  - 재고 관리: `generateInventoryPartId()` - 색상 포함하여 정확한 재고 추적
- **예시**:
  - 단가용: `하이랙-기둥-높이150270kg`
  - 재고용: `하이랙-기둥메트그레이(볼트식)270kg-높이150270kg`

### 4. 하이랙 무게별 사이즈 제한
- **450kg/600kg/700kg**: 45x150 사이즈 제외
- **600kg/700kg**: 80x200 사이즈 추가
- **코드 위치**: `hide45`, `isHeaviest` 플래그로 처리

### 5. 중량랙 사이즈 변환
- **문제**: 추가 옵션은 "45x155" 형식, 실제 부품은 "w1500xd450" 형식
- **해결**: `convertWeightRackSize()` 함수로 변환
- **매핑 테이블**: `EXTRA_TO_BASE_INVENTORY_MAPPING`에서 specification 추출

### 6. 파렛트랙 타이빔 계산
- **문제**: 사이즈별로 타이빔 개수/단이 다름
- **해결**: `calcPalletIronShelfPerLevel()`과 유사한 로직
- **규칙**: 1390→2개, 2590/2790→4개, 기타→2개

### 7. 추가상품6 BOM 분리
- **문제**: "선반+빔" 옵션이 2개 부품으로 분리됨
- **해결**: `extra_options.json`의 `bom` 배열을 직접 사용
- **처리**: 각 bom 항목을 개별 부품으로 추가

### 8. 추가상품5 서버 ID 직접 생성
- **문제**: 매핑 테이블에 블루+오렌지 ID가 없음
- **해결**: 서버 형식으로 직접 조합
- **형식**: `하이랙-선반블루(기둥)+오렌지(가로대)(볼트식)450kg-사이즈60x108450kg`

### 9. 경량랙 사용자 정의 자재
- **특수 기능**: 경량랙만 `customMaterials` 배열 지원
- **용도**: 추가 옵션에 없는 특수 자재 추가
- **저장**: localStorage에 저장

### 10. 스텐랙 version 속성
- **특수 속성**: 다른 랙에는 없는 `version` 속성
- **값**: "V1"만 존재 (고정값)
- **용도**: 향후 확장 가능성

---

## 코드 구조 특수성

### 1. formTypeRacks 분류
```javascript
const formTypeRacks = ["경량랙", "중량랙", "파렛트랙 철판형"];
```
- 파렛트랙은 별도 분리 (weight 속성 때문에)
- 이 배열에 포함된 랙은 동일한 옵션 선택 순서 사용

### 2. 옵션 선택 순서 분기
- 파렛트랙: weight → size → height → level → formType
- formTypeRacks: size → height → level → formType
- 하이랙: color → size → height → level → formType
- 스텐랙: size → height → level → version

### 3. BOM 계산 분기
- 파렛트랙/파렛트랙 철판형: `bomData` 우선, 없으면 `getFallbackBOM()`
- 하이랙/스텐랙: `getFallbackBOM()` 직접 사용
- 경량랙/중량랙: `bomData` 우선, H750은 `makeLightRackH750BOM()`

### 4. 가격 계산 분기
- 경량랙/중량랙/파렛트랙 철판형: BOM 우선, 기본가격 백업
- 파렛트랙: BOM만 사용
- 하이랙: BOM 우선, formType 필수
- 스텐랙: BOM 우선, 기본가격 백업

---

**분석 완료일**: 2025-01-27  
**프로젝트 규모**: 약 20개 컴포넌트, 10개 유틸리티, 3개 서비스  
**주요 파일**: `ProductContext.jsx` (2134줄), `unifiedPriceManager.js` (700+줄)  
**랙 종류**: 6종 (경량랙, 중량랙, 파렛트랙, 파렛트랙 철판형, 하이랙, 스텐랙)

